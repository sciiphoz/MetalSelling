-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;

-- Очистка таблиц (если нужно)
-- DELETE FROM public."History";
-- DELETE FROM public."Order";
-- DELETE FROM public."Supply";
-- DELETE FROM public."Product";
-- DELETE FROM public."Client";
-- DELETE FROM public."Supplier";
-- DELETE FROM public."MetalType";
-- DELETE FROM public."ClientType";

-- Вставка тестовых данных

-- ClientType
INSERT INTO public."ClientType" ("Title") VALUES
('ООО'),
('ИП'),
('Физическое лицо'),
('Постоянный клиент'),
('VIP клиент');

-- MetalType
INSERT INTO public."MetalType" ("Title") VALUES
('Медь'),
('Сталь'),
('Алюминий'),
('Латунь'),
('Бронза'),
('Чугун'),
('Нержавейка');

-- Supplier (цены поставщиков - себестоимость)
INSERT INTO public."Supplier" ("Title", "PricePerPiece") VALUES
('МеталлСнаб', 620.00),
('СтальПром', 510.50),
('ЦветМеталл', 680.75),
('МеталлБаза', 630.25),
('СплавТрейд', 550.00);

-- Product (розничные цены с наценкой 50-75% от себестоимости)
INSERT INTO public."Product" ("IdMetalType", "Title", "Amount", "PricePerPiece") VALUES
(1, 'Медная проволока 3мм', 650, 930.00),  -- наценка 50%
(1, 'Медный лист 2мм', 580, 1085.50),      -- наценка 75%
(2, 'Стальной уголок 40x40', 720, 765.75), -- наценка 50%
(2, 'Стальная арматура 12мм', 680, 893.25), -- наценка 75%
(3, 'Алюминиевый профиль 20x20', 710, 720.00), -- наценка 50%
(3, 'Алюминиевый лист 1.5мм', 590, 833.75), -- наценка 75%
(4, 'Латунный пруток 8мм', 660, 1089.00),  -- наценка 50%
(5, 'Бронзовая втулка', 610, 1191.25),     -- наценка 75%
(6, 'Чугунная заготовка', 690, 825.00),    -- наценка 50%
(7, 'Нержавеющая труба 25мм', 640, 1103.75); -- наценка 75%

-- Client
INSERT INTO public."Client" ("IdClientType", "Name", "Phone", "Email", "PersonalDiscount") VALUES
(1, 'ООО "СтройМеталл"', '+7-495-123-45-67', 'stroy@mail.ru', 5.00),
(1, 'ООО "ПромСнаб"', '+7-495-234-56-78', 'promsnab@mail.ru', 3.50),
(2, 'ИП Иванов А.С.', '+7-916-345-67-89', 'ivanov.ip@mail.ru', 2.00),
(3, 'Петров Сергей', '+7-925-456-78-90', 'petrov@mail.ru', NULL),
(4, 'Сидоров М.В.', '+7-903-567-89-01', 'sidorov@mail.ru', 7.50),
(5, 'ООО "ЭлитМеталл"', '+7-495-678-90-12', 'elit@mail.ru', 10.00),
(2, 'ИП Козлова Е.П.', '+7-916-789-01-23', 'kozlovа@mail.ru', 4.00),
(3, 'Васильев А.Н.', '+7-925-890-12-34', 'vasilev@mail.ru', NULL);

-- Supply за октябрь 2025 (Price = Amount * PricePerPiece из Supplier - себестоимость)
INSERT INTO public."Supply" ("IdSupplier", "IdProduct", "Amount", "Price", "Status", "Date") VALUES
-- Поставки в начале октября
(1, 1, 500, 500 * 620.00, 'завершена', '2025-10-05'),
(2, 3, 600, 600 * 510.50, 'завершена', '2025-10-06'),
(3, 5, 550, 550 * 680.75, 'завершена', '2025-10-07'),
(4, 7, 400, 400 * 630.25, 'завершена', '2025-10-08'),
(5, 9, 450, 450 * 550.00, 'завершена', '2025-10-09'),

-- Поставки в середине октября
(1, 2, 350, 350 * 620.00, 'завершена', '2025-10-15'),
(2, 4, 500, 500 * 510.50, 'завершена', '2025-10-16'),
(3, 6, 300, 300 * 680.75, 'завершена', '2025-10-17'),
(4, 8, 250, 250 * 630.25, 'завершена', '2025-10-18'),
(5, 10, 400, 400 * 550.00, 'завершена', '2025-10-19'),

-- Автоматические поставки в конце октября
(1, 1, 500, 500 * 620.00, 'автоматическая', '2025-10-25'),
(2, 3, 500, 500 * 510.50, 'автоматическая', '2025-10-26'),
(3, 5, 500, 500 * 680.75, 'автоматическая', '2025-10-27');

-- Order за октябрь 2025 (Price = Quantity * PricePerPiece из Product - розничная цена с наценкой)
-- Комплексные заказы (несколько товаров в одном заказе с одинаковой датой)
INSERT INTO public."Order" ("IdProduct", "IdClient", "Quantity", "Price", "Status", "Date") VALUES
-- Заказ 1: ООО "СтройМеталл" от 2025-10-10 (несколько товаров)
(1, 1, 100, 100 * 930.00, 'выполнен', '2025-10-10'),
(3, 1, 150, 150 * 765.75, 'выполнен', '2025-10-10'),
(5, 1, 80, 80 * 720.00, 'выполнен', '2025-10-10'),

-- Заказ 2: ООО "ПромСнаб" от 2025-10-12 (несколько товаров)
(2, 2, 200, 200 * 1085.50, 'выполнен', '2025-10-12'),
(4, 2, 90, 90 * 893.25, 'выполнен', '2025-10-12'),
(6, 2, 70, 70 * 833.75, 'выполнен', '2025-10-12'),

-- Заказ 3: ИП Иванов от 2025-10-14 (несколько товаров)
(7, 3, 120, 120 * 1089.00, 'выполнен', '2025-10-14'),
(8, 3, 60, 60 * 1191.25, 'выполнен', '2025-10-14'),
(9, 3, 180, 180 * 825.00, 'выполнен', '2025-10-14'),

-- Заказ 4: Петров Сергей от 2025-10-16
(10, 4, 110, 110 * 1103.75, 'выполнен', '2025-10-16'),
(1, 4, 50, 50 * 930.00, 'выполнен', '2025-10-16'),

-- Заказ 5: Сидоров М.В. от 2025-10-18 (несколько товаров)
(3, 5, 100, 100 * 765.75, 'выполнен', '2025-10-18'),
(5, 5, 120, 120 * 720.00, 'выполнен', '2025-10-18'),
(7, 5, 80, 80 * 1089.00, 'выполнен', '2025-10-18'),

-- Заказ 6: ООО "ЭлитМеталл" от 2025-10-20
(2, 6, 150, 150 * 1085.50, 'выполнен', '2025-10-20'),
(4, 6, 100, 100 * 893.25, 'выполнен', '2025-10-20'),

-- Заказ 7: ИП Козлова от 2025-10-22
(6, 7, 90, 90 * 833.75, 'выполнен', '2025-10-22'),
(8, 7, 70, 70 * 1191.25, 'выполнен', '2025-10-22'),

-- Заказ 8: Васильев А.Н. от 2025-10-24
(9, 8, 130, 130 * 825.00, 'выполнен', '2025-10-24'),
(10, 8, 95, 95 * 1103.75, 'выполнен', '2025-10-24'),

-- Заказы в конце октября (вызывающие автоматические поставки)
(1, 1, 400, 400 * 930.00, 'в ожидании', '2025-10-28'),
(3, 2, 350, 350 * 765.75, 'в ожидании', '2025-10-28'),
(5, 3, 300, 300 * 720.00, 'в ожидании', '2025-10-29');

-- History (движения товаров за октябрь 2025)
INSERT INTO public."History" ("IdProduct", "Quantity", "Date") VALUES
-- Поступления в начале октября
(1, 500, '2025-10-05'),
(3, 600, '2025-10-06'),
(5, 550, '2025-10-07'),
(7, 400, '2025-10-08'),
(9, 450, '2025-10-09'),

-- Продажи в середине октября
(1, -100, '2025-10-10'),
(3, -150, '2025-10-10'),
(5, -80, '2025-10-10'),
(2, -200, '2025-10-12'),
(4, -90, '2025-10-12'),
(6, -70, '2025-10-12'),
(7, -120, '2025-10-14'),
(8, -60, '2025-10-14'),
(9, -180, '2025-10-14'),

-- Поступления в середине октября
(2, 350, '2025-10-15'),
(4, 500, '2025-10-16'),
(6, 300, '2025-10-17'),
(8, 250, '2025-10-18'),
(10, 400, '2025-10-19'),

-- Продажи во второй половине октября
(10, -110, '2025-10-16'),
(1, -50, '2025-10-16'),
(3, -100, '2025-10-18'),
(5, -120, '2025-10-18'),
(7, -80, '2025-10-18'),
(2, -150, '2025-10-20'),
(4, -100, '2025-10-20'),
(6, -90, '2025-10-22'),
(8, -70, '2025-10-22'),
(9, -130, '2025-10-24'),
(10, -95, '2025-10-24'),

-- Автоматические поставки в конце октября
(1, 500, '2025-10-25'),
(3, 500, '2025-10-26'),
(5, 500, '2025-10-27'),

-- Крупные продажи в конце октября (вызывают автоматические поставки)
(1, -400, '2025-10-28'),
(3, -350, '2025-10-28'),
(5, -300, '2025-10-29');

-- Обновление количества продуктов после всех операций
UPDATE public."Product" SET "Amount" = 650 WHERE "Id" = 1;
UPDATE public."Product" SET "Amount" = 580 WHERE "Id" = 2;
UPDATE public."Product" SET "Amount" = 720 WHERE "Id" = 3;
UPDATE public."Product" SET "Amount" = 680 WHERE "Id" = 4;
UPDATE public."Product" SET "Amount" = 710 WHERE "Id" = 5;
UPDATE public."Product" SET "Amount" = 590 WHERE "Id" = 6;
UPDATE public."Product" SET "Amount" = 660 WHERE "Id" = 7;
UPDATE public."Product" SET "Amount" = 610 WHERE "Id" = 8;
UPDATE public."Product" SET "Amount" = 690 WHERE "Id" = 9;
UPDATE public."Product" SET "Amount" = 640 WHERE "Id" = 10;

END;